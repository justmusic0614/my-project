{
  "version": "2.0",
  "lastUpdated": "2026-02-19",

  "apiKeys": {
    "fmp": "${FMP_API_KEY}",
    "perplexity": "${PERPLEXITY_API_KEY}",
    "anthropic": "${ANTHROPIC_API_KEY}",
    "finmind": "${FINMIND_API_TOKEN}",
    "telegram": {
      "botToken": "${TELEGRAM_BOT_TOKEN}",
      "chatId": "${TELEGRAM_CHAT_ID}"
    },
    "secEdgar": "${SEC_EDGAR_USER_AGENT}"
  },

  "http": {
    "timeout": 10000,
    "retries": 3,
    "userAgent": "MarketDigest/1.0 (Node.js)",
    "headers": {
      "User-Agent": "MarketDigest/1.0 (Node.js)"
    }
  },

  "cache": {
    "enabled": true,
    "ttl": {
      "stockInfo": 86400000,
      "monthlyRevenue": 3600000,
      "quarterlyReport": 86400000,
      "dividend": 86400000,
      "financialRatio": 86400000,
      "dailyTrade": 3600000,
      "chipData": 3600000,
      "marginTrading": 3600000,
      "institutional": 3600000,
      "news": 1800000,
      "marketData": 300000
    },
    "maxSize": "100MB",
    "paths": {
      "financial": "data/financial-cache",
      "chip": "data/chip-cache",
      "news": "data/news-cache"
    }
  },

  "deduplication": {
    "algorithm": "jaccard",
    "threshold": 0.85,
    "keywordOverlapMin": 3,
    "titlePrefixLength": 10,
    "enabled": true
  },

  "dataSources": {
    "rss": [
      {
        "id": "yahoo-tw",
        "name": "Yahoo Finance 台股",
        "url": "https://tw.stock.yahoo.com/rss?category=tw-market",
        "type": "rss",
        "category": "Taiwan_Market",
        "enabled": true
      },
      {
        "id": "cnbc-business",
        "name": "CNBC Business News",
        "url": "https://search.cnbc.com/rs/search/combinedcms/view.xml?partnerId=wrss01&id=10001147",
        "type": "rss",
        "category": "Equity_Market",
        "enabled": true
      },
      {
        "id": "cnbc-investing",
        "name": "CNBC Markets",
        "url": "https://search.cnbc.com/rs/search/combinedcms/view.xml?partnerId=wrss01&id=15839069",
        "type": "rss",
        "category": "Equity_Market",
        "enabled": true
      },
      {
        "id": "udn-business",
        "name": "經濟日報",
        "url": "https://money.udn.com/rssfeed/news/1001/5591/latest",
        "type": "rss",
        "category": "Taiwan_Market",
        "enabled": true
      }
    ],
    "api": {
      "yahoo": {
        "base": "https://query1.finance.yahoo.com/v8/finance/chart/",
        "enabled": true
      },
      "twse": {
        "dailyTrade": "https://openapi.twse.com.tw/v1/exchangeReport/STOCK_DAY_ALL",
        "marginTrading": "https://openapi.twse.com.tw/v1/exchangeReport/MI_MARGN",
        "institutional": "https://www.twse.com.tw/rwd/zh/fund/T86",
        "enabled": true
      },
      "mops": {
        "stockInfo": "https://openapi.twse.com.tw/v1/opendata/t187ap03_L",
        "monthlyRevenue": "https://openapi.twse.com.tw/v1/opendata/t187ap05_L",
        "quarterlyReport": "https://openapi.twse.com.tw/v1/opendata/t187ap14_L",
        "financialRatio": "https://openapi.twse.com.tw/v1/opendata/t187ap06_L",
        "enabled": true
      },
      "perplexity": {
        "model": "sonar",
        "baseUrl": "https://api.perplexity.ai",
        "cacheTtl": 1800000,
        "enabled": true
      },
      "fmp": {
        "baseUrl": "https://financialmodelingprep.com",
        "watchlist": ["NVDA","AAPL","MSFT","GOOGL","AMZN","META","AVGO","TSM","AMD","BRK-B","BAC","OXY","CVX","KO","QQQ","SPY"],
        "cacheTtl": 1800000,
        "dailyQuotaLimit": 200,
        "fmpPlan": "starter",
        "enabled": true
      },
      "finmind": {
        "baseUrl": "https://api.finmindtrade.com/api/v4",
        "watchlist": ["2330","0050","0056"],
        "tw50Filter": true,
        "cacheTtl": 3600000,
        "enabled": true
      },
      "secEdgar": {
        "baseUrl": "https://efts.sec.gov/LATEST/search-index?q=",
        "filingUrl": "https://www.sec.gov/cgi-bin/browse-edgar",
        "eftsUrl": "https://efts.sec.gov/LATEST/search-index",
        "edgarFullTextSearch": "https://efts.sec.gov/LATEST/search-index",
        "submissionsUrl": "https://data.sec.gov/submissions/CIK{cik}.json",
        "userAgent": "${SEC_EDGAR_USER_AGENT}",
        "filingTypes": ["8-K", "13F", "4", "10-K", "10-Q"],
        "lookbackHours": 24,
        "rateLimitMs": 100,
        "cacheTtl": 1800000,
        "enabled": true
      }
    },
    "manual_input": {
      "type": "line_group",
      "description": "LINE 群組早報（已停用，改用 API+RSS+Perplexity）",
      "enabled": false
    }
  },

  "logging": {
    "level": "info",
    "format": "pretty",
    "output": "stdout",
    "errorOutput": "stderr",
    "file": {
      "enabled": false,
      "path": "logs/market-digest.log",
      "maxSize": "10MB",
      "maxFiles": 7
    }
  },

  "telegram": {
    "botToken": "${TELEGRAM_BOT_TOKEN}",
    "chatId": "${TELEGRAM_CHAT_ID}",
    "enabled": true,
    "maxMessageLength": 4000,
    "preview": {
      "maxItems": 3
    },
    "fullReport": {
      "maxItems": 10
    }
  },

  "processing": {
    "dedup_threshold": 0.85,
    "min_news_count": 5,
    "max_age_hours": 24,
    "filterKeywords": true,
    "keywords": [
      "台積電", "TSMC", "外資", "台股", "美股",
      "Fed", "AI", "聯發科", "鴻海"
    ]
  },

  "technicalIndicators": {
    "ma_periods": [5, 20],
    "rsi_period": 14,
    "enabled": true
  },

  "importanceRules": {
    "critical_keywords": [
      "Fed", "央行", "升息", "降息", "台積電", "TSMC"
    ],
    "high_keywords": [
      "財報", "法說會", "GDP", "CPI", "聯電", "鴻海",
      "台股", "加權指數"
    ],
    "taiwan_keywords": [
      "台股", "台積電", "聯電", "鴻海", "大立光",
      "台灣", "TSMC"
    ],
    "volume_spike_threshold": 1.5,
    "price_change_threshold": 2.0
  },

  "rateLimits": {
    "perplexity": { "reqPerMin": 5 },
    "fmp": { "reqPerMin": 10 },
    "finmind": { "reqPerMin": 26 },
    "secEdgar": { "reqPerSec": 10, "intervalMs": 100 }
  },

  "costLedger": {
    "enabled": true,
    "dailyBudgetUsd": 2.0,
    "usdToTwd": 33,
    "llmPrices": {
      "haiku_input": 0.00000025,
      "haiku_output": 0.00000125,
      "sonnet_input": 0.000003,
      "sonnet_output": 0.000015
    }
  },

  "anthropic": {
    "apiKeyEnv": "ANTHROPIC_API_KEY",
    "models": {
      "screening": "claude-haiku-4-5-20251001",
      "analysis": "claude-sonnet-4-5-20250929"
    },
    "maxTokens": {
      "screening": 1024,
      "analysis": 4096
    },
    "temperature": {
      "screening": 0.3,
      "analysis": 0.5
    }
  },

  "twoStageSummarize": {
    "enabled": true,
    "stage1Model": "claude-haiku-4-5-20251001",
    "stage2Model": "claude-sonnet-4-5-20250929"
  },

  "watchlist": {
    "us": {
      "mag7": ["NVDA", "AAPL", "MSFT", "GOOGL", "AMZN", "META"],
      "semiconductor": ["AVGO", "TSM", "AMD"],
      "berkshire": ["BRK-B", "BAC", "OXY", "CVX", "KO"],
      "index_etf": ["QQQ", "SPY", "^VIX"]
    },
    "tw": {
      "core": ["2330", "0050", "0056"],
      "tw50Filter": true
    }
  },

  "importancePriority": {
    "P0_critical": ["Fed", "FOMC", "CPI", "GDP", "央行", "升息", "降息", "衰退", "recession"],
    "P1_high": ["財報", "earnings", "法說會", "NVIDIA", "台積電", "TSMC", "AI", "半導體", "semiconductor"],
    "P2_medium": ["外資", "投信", "買超", "賣超", "融資", "融券"],
    "P3_low": []
  },

  "unifiedReport": {
    "morning": {
      "defaultLevel": "standard",
      "maxChars": { "minimal": 800, "standard": 3800, "full": 10000 },
      "sectionWeights": {
        "aiQuickSummary": 100,
        "marketData": 95,
        "regime": 90,
        "primarySignals": 85,
        "keyEvents": 80,
        "watchlistRadar": 75,
        "macroPolicy": 60,
        "crossAsset": 55,
        "taiwanMarket": 50,
        "secondaryContext": 40,
        "perplexityResearch": 35,
        "eventCalendar": 30
      }
    },
    "weekly": {
      "defaultLevel": "standard",
      "maxChars": { "standard": 3800 }
    }
  },

  "pipeline": {
    "phases": {
      "phase1": {
        "name": "US Market Collection",
        "cronUtc": "30 21 * * 1-5",
        "description": "美股收集（UTC 21:30 = 台北 05:30）",
        "timeout": 120000,
        "retries": 3
      },
      "phase2": {
        "name": "TW Market + RSS + Perplexity",
        "cronUtc": "30 23 * * 1-5",
        "description": "台股+RSS+Perplexity（UTC 23:30 = 台北 07:30）",
        "timeout": 180000,
        "retries": 3
      },
      "phase3": {
        "name": "Process & Analyze",
        "cronUtc": "45 23 * * 1-5",
        "description": "驗證+去重+AI分析（UTC 23:45 = 台北 07:45）",
        "timeout": 120000,
        "retries": 2
      },
      "phase4": {
        "name": "Assemble & Publish",
        "cronUtc": "0 0 * * 2-6",
        "description": "組裝+推播（UTC 00:00 = 台北 08:00）",
        "timeout": 60000,
        "retries": 2
      },
      "weekend": {
        "cronUtc": "0 0 * * 0,6",
        "description": "週末日報（快取+Perplexity）",
        "timeout": 180000,
        "retries": 2
      },
      "weekly": {
        "cronUtc": "30 9 * * 5",
        "description": "週報（UTC 09:30 = 台北 17:30 週五）",
        "timeout": 300000,
        "retries": 2
      }
    },
    "stateDir": "data/pipeline-state",
    "degradation": {
      "labels": {
        "delayed": "[DELAYED]",
        "unverified": "[UNVERIFIED]",
        "unavailable": "N/A"
      }
    }
  },

  "validation": {
    "thresholds": {
      "TAIEX": { "min": 10000, "max": 50000, "maxDailyChange": 0.10, "crossCheckTolerance": 0.005 },
      "SP500": { "min": 2000, "max": 15000, "maxDailyChange": 0.07, "crossCheckTolerance": 0.003 },
      "NASDAQ": { "min": 5000, "max": 30000, "maxDailyChange": 0.07, "crossCheckTolerance": 0.003 },
      "USDTWD": { "min": 28.0, "max": 35.0, "maxDailyChange": 0.02, "crossCheckTolerance": 0.005 },
      "VIX": { "min": 8, "max": 90, "maxDailyChange": 0.50 },
      "DXY": { "min": 80, "max": 130, "maxDailyChange": 0.03 },
      "US10Y": { "min": 0.5, "max": 8.0, "maxDailyChange": 0.003 }
    },
    "crossCheck": {
      "TAIEX": ["twse", "finmind"],
      "SP500": ["fmp", "yahoo"],
      "NASDAQ": ["fmp", "yahoo"],
      "USDTWD": ["twse", "yahoo"]
    }
  },

  "perplexityQueries": {
    "fixed": [
      "今日全球金融市場最重要的5件事，包含美股、台股、總經、地緣政治"
    ],
    "dynamic": {
      "enabled": true,
      "description": "根據 Phase 1 熱點動態生成查詢"
    },
    "geopolitics": {
      "enabled": true,
      "triggerKeywords": ["戰爭", "制裁", "關稅", "地震", "海峽", "war", "sanction", "tariff"],
      "query": "最新地緣政治風險事件對金融市場的影響"
    }
  },

  "sre": {
    "healthCheck": {
      "enabled": true,
      "interval": 300000
    },
    "circuitBreaker": {
      "enabled": true,
      "threshold": 5,
      "timeout": 60000,
      "resetTimeout": 300000
    },
    "metrics": {
      "enabled": true,
      "collectInterval": 60000
    },
    "alerting": {
      "enabled": true,
      "pipelineFailure": true,
      "phaseTimeout": true,
      "validationFailure": true,
      "costOverBudget": true
    }
  },

  "paths": {
    "data": "data",
    "cache": "data/cache",
    "output": "data/output",
    "newsCollect": "data/news-collect",
    "dailyBrief": "data/daily-brief",
    "weeklyReport": "data/weekly-report",
    "pipelineState": "data/pipeline-state",
    "watchlist": "data/watchlist.json",
    "logs": "logs"
  },

  "dataRetention": {
    "news": 30,
    "marketData": 90,
    "cache": 7,
    "logs": 30,
    "pipelineState": 7,
    "weeklyReport": 90
  }
}
