# Market Digest

股票追蹤與分析系統，整合財報、籌碼面數據與智慧分析。

## 快速開始

### Telegram 指令
```
/financial        # 日報
/weekly          # 週報
/analyze 2330    # 單檔分析
/alerts          # 異常檢查
```

### 建立追蹤清單
```
/watchlist add 2330 2454 2408
```

## 核心功能模組

### 模組 E2：財報數據整合

自動抓取上市公司基本資料與財務數字。

**數據項目**：
- **產業分類**：股票所屬產業
- **月營收**：當月、累計營收、年增率
- **季度財報**：EPS、淨利率

**資料來源**：台灣證券交易所 OpenAPI（BWIBBU_ALL、t187ap03_L）

### 模組 E3：籌碼面數據整合

分三層抓取每日交易籌碼數據。

**Layer 1 — 基礎交易**：
- 收盤價、成交量、開高低收、成交筆數

**Layer 2 — 融資融券**：
- 融資/融券餘額（前日、今日、變化量）
- 融資使用率計算
- 資券互抵

**Layer 3 — 三大法人買賣超**：
- 外資、投信、自營商各別買賣超
- 三大法人合計

**資料來源**：STOCK_DAY_ALL、MI_MARGN、T86

### 模組 F：智慧分析系統

對每檔股票計算綜合評分（0–100 分）並標示訊號。

**評分規則**：
- 基準分 50（中性起點）
- 依融資使用率、三大法人情緒加減分

**評分對應**：

| 分數 | 訊號 | 意義 |
|------|------|------|
| ≥ 65 | 🟢 偏多 | 籌碼面健康、法人買進 |
| 35-64 | ➖ 中性 | 無明顯方向 |
| ≤ 34 | 🔴 偏空 | 籌碼面疑慮大 |

**融資使用率警戒級別**：

| 使用率 | 警示 |
|--------|------|
| < 5% | ✅ 健康 |
| 5-15% | ⚠️ 正常 |
| 15-30% | 🟡 偏高 |
| > 30% | 🔴 危險 |

### 模組 C：週報統計

統計追蹤清單中所有股票的週度法人動向。

- 外資、投信、自營商累計買賣超與日均值
- 連續買超 / 賣超天數
- 整體籌碼分布（偏多 / 偏空 / 中性比例）
- 週度大幅買賣超排名（> 10,000 張）

### 模組 A：智慧提醒系統

每日 16:00（台北時間）自動掃描追蹤清單，偵測異常時推播。

**高優先級（立即告警）**：
- 融資使用率 > 30%
- 外資單日買賣超 > 10,000 張
- 籌碼評分 < 30

**中優先級（留意觀察）**：
- 融資使用率 > 20%
- 融資單日大增 > 10%
- 投信買超 > 2,000 張
- 融券回補 > 15%（空頭回補利多）

**冷卻機制**：同股同類型提醒 24 小時內不重複推播

### 模組 D：Telegram 指令介面

透過 telegram-wrapper.sh 統一包裝，過濾 debug 訊息，提供乾淨的輸出格式。

## Telegram 指令總覽

### 追蹤清單管理
```
/watchlist list              # 列出清單
/watchlist add 2330 2454     # 新增股票
/watchlist remove 2330       # 移除股票
```

### 報告查詢
```
/financial                   # 日報（財報＋籌碼＋智慧分析）
/weekly                      # 週報（近 5 個交易日）
/weekly 7                    # 週報（近 7 日）
/analyze 2330                # 單檔深度分析
/alerts                      # 手動觸發異常檢查
```

### 早報搜尋
```
/query 聯發科                # 搜尋近 7 天早報
/query 台積電 --days 30      # 搜尋近 30 天早報
```

## 自動化排程

| 時間（台北）| 任務 | 說明 |
|------------|------|------|
| 08:00–08:10 | 自動收集早報 | 新聞、市場數據 |
| 08:30 | 生成早報整合報告並推播 | |
| 16:00（每日）| 自動異常檢測 | 發現高優先級異常時推播 |
| 每週日 20:00 | 自動推播週報 | |

## 資料來源

| API | 內容 | 快取 TTL |
|-----|------|----------|
| STOCK_DAY_ALL | 每日交易數據 | 1 小時 |
| MI_MARGN | 融資融券 | 1 小時 |
| T86 | 三大法人買賣超 | 1 小時 |
| BWIBBU_ALL | 月營收 | 1 小時 |
| t187ap03_L | 股票基本資料 | 1 小時 |

另外整合：Yahoo Finance（台指、美股三大指數、匯率）

## 新聞處理規則

**Pipeline 規則**：
- 每日最多 12 則新聞，跨 section 去重
- Clickbait 過濾：保留資訊價值，改寫煽動性標題為中性語氣

**信心等級**：
- **HIGH**：所有數據來源正常
- **MEDIUM**：部分數據延遲（週末為正常狀況）
- **LOW**：出現數據缺失，報告加警示 ⚠️

## 專案狀態

**版本：** Phase 2 Complete
**完成度：** 100%（6/6 核心項目）
**狀態：** ✅ 可使用

## 待規劃功能（選項）

- Watchlist 進階管理（標籤分類、自訂排序）
- K 線圖表輸出
- 技術指標整合（MA5/MA20、RSI）
- 自動選股功能

## 文件導覽

- **QUICK_REFERENCE.md** - 快速參考卡（必讀）
- **USER_MANUAL.md** - 完整使用手冊
- **FEATURES_SUMMARY.md** - 功能總覽
- **DEPLOYMENT_COMPLETE.md** - 部署報告

## 疑難排解

**常見問題**：

1. **推播失敗**：檢查 Telegram Bot Token 是否有效
2. **數據更新延遲**：台灣證交所 API 可能延遲（特別是假日後）
3. **融資使用率計算錯誤**：確認是否有最新的融資限額數據
4. **異常提醒過於頻繁**：調整 `config.json` 中的閾值

## 技術支援

問題或建議透過 Telegram 告訴 Clawdbot。
